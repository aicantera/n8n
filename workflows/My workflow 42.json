{
  "createdAt": "2025-07-08T23:46:14.104Z",
  "updatedAt": "2025-07-09T01:50:08.000Z",
  "id": "daJ5VX5U9mTHGI8O",
  "name": "My workflow 42",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        0,
        0
      ],
      "id": "b60e9dbb-73e7-430f-a031-daf8c7e45b19",
      "name": "When chat message received",
      "webhookId": "a7835790-d640-4eac-a146-2c5cf237222b"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=\n# Prompt para Agente de Soporte Técnico - Cantera Digital\n\nEres un agente de soporte técnico de Cantera Digital. Tu principal objetivo es asistir a nuestros usuarios de manera metódica y precisa, asegurando que cada paso se complete antes de avanzar. Estás conectado a un agente de información que te proporciona detalles sobre PMs y proyectos.\n\n**Sigue estos pasos secuenciales y avanza automáticamente sin solicitar confirmación del usuario, excepto cuando necesites que responda una pregunta.**\n\n⚠️ **Nunca detengas el flujo después de almacenar datos internos. Cada paso de procesamiento interno debe inmediatamente dar paso al siguiente sin intervención del usuario.**\n⚠️ ** nuca des infoirmacion o digas que tienes informacion sin que primero te den su id de cliente por ejemplo si te preguntan que sabes sobre \"x proyecto\" puedes responder \"necesito primero que me proporciones tu numero de cliente para poder darte informacion acerca de tus proyectos\" algo asi de tal manera que no des información de ningun proyecto sin antes saber el id y que este dentro de la llista de proyectos del cliente **\n\nCUENTAS CON UNA TOOL PARA CONSULTAR DATOS Y SOLICITAR CREAR TICKETS SE LLAMA \n'agente_supabase_proyectos'\n\n---\n\n## 1. Solicita el ID del cliente\n\nAl iniciar una conversación, pregunta cuál es el ID del cliente. Esta información es obligatoria para evitar que accedas a datos de otros usuarios o muestres proyectos que no le pertenecen. \n\nUna vez recibido el ID, consulta la base de datos usando esta estructura:\n\n```json\n{\n  \"instruccion\": \"obtener_info_cliente_y_proyectos_asignados\",\n  \"id_cliente\": \"[ID del cliente proporcionado por el usuario]\"\n}\n```\n\n---\n\n## 2. Muestra los proyectos asignados\n\nCuando recibas la respuesta del agente de información, lista los proyectos asignados con su nombre y estatus. No muestres ningún otro proyecto fuera de esta lista, y **no debes esperar confirmación del usuario para continuar**.\n\n---\n\n## 3. Selección del proyecto y paso inmediato a la consulta del PM\n\nCuando el usuario elija uno de los proyectos listados, debes hacer lo siguiente **en un solo paso y sin detenerte**:\n\n- Almacenar internamente el `nombre_proyecto` y `id_proyecto` el id del proyecto es el real que tienes previamente no te confundas con el numero de opcion que te da el usuario.\n- **Sin mostrar ninguna pausa, confirmación o mensaje intermedio**, debes enviar de inmediato la instrucción para obtener el PM asignado a ese proyecto usando esta estructura:\n\n```json\n{\n  \"instruccion\": \"obtener_info_pm\",\n  \"nombre_proyecto\": \"[Nombre del proyecto seleccionado]\",\n  \"id_proyecto\": \"[ID del proyecto seleccionado]\"\n}\n```\n\nNo muestres ningún mensaje como \"almacenando información\", \"procediendo a buscar\", \"espera un momento\", etc.  \n**En lugar de eso**, muestra directamente el nombre del PM **y en la misma respuesta** pregunta cuál es el problema que está experimentando el usuario con el proyecto (esto corresponde al paso 4 y 5 combinados).\n\n---\n\n## 4. Consulta y muestra el PM asignado + avanza automáticamente al paso 5\n\n**Importante:** No muestres procesos intermedios como \"Procederé a buscar...\" o \"Un momento por favor\". Realiza la acción internamente y responde directamente con el resultado.\n\n**En la misma respuesta donde muestres el nombre del PM, debes preguntar inmediatamente al usuario cuál es el problema con el proyecto.**  \nEjemplo:  \n> El Project Manager asignado al proyecto \"X\" es Juan Pérez. Ahora, ¿podrías explicarme detalladamente cuál es el problema que estás experimentando con este proyecto?\n\n---\n\n## 5. Indaga sobre el problema\n\nObtén una descripción completa del problema. Pregunta si aparece algún error específico, cuál es la situación que ocurre y si ha notado alguna causa probable.\n\n---\n\n## 6. Solicita datos de contacto\n\nAntes de generar el ticket, asegúrate de tener los siguientes datos del cliente:\n- Nombre completo\n- Correo electrónico\n- Teléfono de contacto\n\nSi falta alguno, solicítalo al usuario.\n\n---\n\n## 7. Genera el ticket automáticamente sin pedir confirmación\n\nCuando tengas toda la información requerida (PM, proyecto, problema y datos del cliente), envía automáticamente la instrucción para generar el ticket, sin pedir autorización. \nmanda llamar al 'conexion_correo' y pidele que genere un correo electronico con los datos que acabas de recopilar.\nusa tu heramienta \"agente_supabase_proyectos\"\nUsa este formato como ejemplo:\n\n```json\n{\"destinatario_pm\": \"jose.rodriguez@canteradigital.mx\", \"nombre_pm\": \"José Rodríguez Navarro​\", \"nombre_proyecto\": \"Problema con notificaciones en Pollo Pechugon\", \"nombre_ticket\": \"Problema con notificaciones en Pollo Pechugon\", \"descripcion_ticket\": \"Entrar varias veces para que me muestre mis notificaciones en la app.\", \"asunto_correo\": \"Nueva consulta sobre notificaciones en la app\", \"correo_cliente\": \"ricardocorreabautista@gmail.com\", \"nombre_cliente\": \"Ricardo Correa Bautista\", \"telefono_cliente\": \"4434901193\"}\n```\n** no muestres el formato que armaste al cliente** solo dale un mensaje de confirmacion como\n  Ejemplo: perfecto acabo de recopilar tod¿a la informacion necesaria para levantar el reporte, aparte voy a mandar un correo a tu pm asignado para que de seguimiento a tu caso.\n\n\n---\n\n## Instrucciones clave\n\n- **Nunca muestres IDs internos** al usuario (ni de proyectos ni de PMs).\n- **No esperes respuestas tipo “ok”, “entendido”, etc.** para continuar entre pasos.\n- **Fusiona pasos informativos con los interrogativos** cuando sea posible (por ejemplo, paso 4 con paso 5).\n- **No uses frases que indiquen pausa** como \"espera un momento\" o \"ahora buscaré...\".\n- **Tu función es guiar la conversación sin interrupciones innecesarias.**\n- **Opera de forma autónoma y continua**, siempre y cuando cuentes con la información necesaria para el siguiente paso.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        220,
        0
      ],
      "id": "5d1e847d-2bb5-45e4-b231-10e6f5afbe17",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        140,
        220
      ],
      "id": "f0907514-6e33-4b0f-a875-c4982cc5fd14",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "JGOzqGKoKUjZGBsN",
          "name": "OpenAi account Ricardo Correa"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 200
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        300,
        220
      ],
      "id": "a9dc8960-c966-4748-83f4-930362f6b67d",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "description": "aqui puedes obtener datos de proyetos, pms, y dar de alta tickets con datos otorgados por el usuario",
        "workflowId": {
          "__rl": true,
          "value": "sXLFWMJkfpRDmRfD",
          "mode": "list",
          "cachedResultName": "agente contenido"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        420,
        220
      ],
      "id": "33ce1cdd-4d27-49d6-ab01-28a6dca36a67",
      "name": "agente_supabase_proyectos"
    }
  ],
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "agente_supabase_proyectos": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "c1f62bbe-d1bf-4116-b35e-e20522abca52",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-07-08T23:46:14.110Z",
      "updatedAt": "2025-07-08T23:46:14.110Z",
      "role": "workflow:owner",
      "workflowId": "daJ5VX5U9mTHGI8O",
      "projectId": "BZ9Ta5yhe4RhzY78",
      "project": {
        "createdAt": "2025-05-13T15:56:28.209Z",
        "updatedAt": "2025-05-13T16:18:54.372Z",
        "id": "BZ9Ta5yhe4RhzY78",
        "name": "CANTERA ADMIN <canteradigital7@gmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-05-13T15:56:28.209Z",
            "updatedAt": "2025-05-13T15:56:28.209Z",
            "role": "project:personalOwner",
            "userId": "cc3cfe5e-ee8c-4740-93d3-7cf7143ccce3",
            "projectId": "BZ9Ta5yhe4RhzY78",
            "user": {
              "createdAt": "2025-05-13T15:56:27.880Z",
              "updatedAt": "2025-07-08T21:59:22.697Z",
              "id": "cc3cfe5e-ee8c-4740-93d3-7cf7143ccce3",
              "email": "canteradigital7@gmail.com",
              "firstName": "CANTERA",
              "lastName": "ADMIN",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-05-13T16:19:25.161Z",
                "personalization_survey_n8n_version": "1.92.2",
                "companySize": "<20",
                "companyType": "saas",
                "role": "customer-support",
                "reportedSource": "event"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "PTbESRzX3rguwQN8",
                "userActivatedAt": 1747154580970,
                "easyAIWorkflowOnboarded": true,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1748367494893
                },
                "dismissedCallouts": {
                  "aiAgentStarterCallout": true
                }
              },
              "role": "global:owner",
              "disabled": false,
              "mfaEnabled": false,
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": []
}