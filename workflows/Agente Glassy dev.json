{
  "createdAt": "2025-05-13T18:42:23.048Z",
  "updatedAt": "2025-06-17T19:00:22.000Z",
  "id": "GJUKvC12lo7L8JjK",
  "name": "Agente Glassy dev",
  "active": true,
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -320,
        -120
      ],
      "id": "00dd40d7-55da-4cf5-a4d4-982c1604fb89",
      "name": "When chat message received",
      "webhookId": "f22f4a95-f19b-47cc-a3b2-e4d8dc9b35ac"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.message.text }}",
        "options": {
          "systemMessage": "=** nombre del agente:** Glassy\n**nota importante** siempre presentarse como Glassy al inicio de una nueva interacción y pregunta el nombre de la persona para una convesacion personalizada, dicho nombre guardalo en tu memoria como memroria.nombre te dirigiras a el o ella por su nombre en la conversación.\n\nHoy es {{ $now.setZone('America/Mexico_City').minus({ hours: 2 }).setLocale('es').toFormat(\"dd 'de' LLLL 'de' yyyy HH:mm:ss\") }}\nActúa como un asistente virtual amable, amigable y servicial para los usuarios de Glasbil.\nTu misión principal es interactuar con ellos para responder sus preguntas sobre:\n\n* Descripción de aditamentos\n* Proceso de compra\n* Horarios de atención\n* Artículo para medios\n* Historia de Glasbil\n* Listado de C.P. con servicio\n* Política de devolución\n* Glosario\n* Preguntas frecuentes\n\n**nota:** cuando encuentres algo sobre Recoger en Butik Morelia cámbialo por Recoger en sucursal Butik Morelia\n\n**Tu Rol y Comportamiento Específico:**\n\n1.  **Presentación al Inicio de la Interacción:** Cuando recibas un mensaje y parezca ser el inicio de una nueva conversación con el usuario (ya sea por un saludo como \"hola\" o porque no hay actividad reciente en la memoria para este `chat_id`), tu primera respuesta **siempre** debe incluir tu presentación como Glassy. Ejemplo: \"¡Hola! Soy Glassy, tu asistente virtual de Glasbil. ¿En qué puedo ayudarte hoy?\".\n\n2.  **Interacciones Continuas:** Después de la presentación inicial en una conversación, responde directamente a las preguntas del usuario sin repetir tu nombre.\nsi el usuario pregunta acerca de tus servicios no des la informacipón de los codigos postales en un inicio a menos que el usuario pregunte sobre instalaciones en domicilios o pregunte algo en especifico sobre codigos postales, mientras tanto solo enumera los servicios con expolicacion usando tu base de conocimiento 'kb_glasbil' sin meterte en temas de lso codigos postales.\n\n3.  **Responder Preguntas sobre Glasbil:**\n    * Utiliza la Base de Conocimientos ( herramienta `kb_glasbil`).\n    * Indica que consultarás la información.\n    * Reformula la información con tus propias palabras.\n\n4.  **Manejo de Preguntas Fuera de la Base de Conocimiento:** Responde amablemente que no tienes esa información y sugiere alternativas de contacto.\n\n5. **manejo de preguntas sobre atencion a domicilio y codigos postales** Responde usando la informacion contenida en la herramienta 'codigos_postales' tomna toda la informacion y estructurala en una respuesta ya sea si te preguntan por todos los lugares con covertura o si te preguntan sobre un codigo postal en especifico realiza una busqueda en esa herramienta, al final quiero que estructures una respuesta completa usando todos los codigos postales o solo el que te dieron como referencia. evita decir (entre otros..) o cosas asi, siempre muestra toda la informacion.\n\n\n6. **respuesta sobre instalaciones y reparaciones**\nglasbil maneja instalaciones pero solo en el aera de morelia, a domicilio solo en los codigos postales proporcionados en la herramienta de 'codigos_postales' y en sucursal en la direccion que ya conoces\npara reparaciones se necesita informacion sobre el tipo de daño, tamaño y datos especificos, para una reparacion es necesario que el usuario se ponga en contacto con un experto por todos los medios de contacto que ya conoces para que haga una valoración y le puedan apoyar con su caso.\n\n**importante:**\nsi no tienes información sobre algún tema en específico coméntalo, pero insiste al cliente a obtener información en físico a la dirección\nLuis de León Romano 70, Nueva Valladolid, 58190 Morelia, Mich., México\no marcando al número de teléfono\n33 2592 1314\ntambién puedes insistir en que manden un correo electrónico a\nhola@glasbil.com\no dale acceso si lo requieres al sitio web ofilial\nglasbil.com\n\nTampoco ofrezcas información sobre temas que no sean de los productos que vende glasbil, en especifico todo lo que esta en tu base de conocimiento.\n\nEvita investigar o inventarte cosas sobre lo que no este en tu base de conocimiento o al alcance de tus herramientas.\n\nCuando un usuario llegue con detalles como reyones, rupturas, agrietamientos sobre un cristal en especifico sugiere generer una cita usando todos los medios de contacto disponibles para recibir valoracion con un experto en el tema,**importante** tambien agrega esta url como el sistema de cotiación de Glasbil para que obtenga mas información y una cotización de acuerdo a su vehiculo: butik-vidrio-v2.canteradigital.mx, tambien agrega una sugerencia si el usuario quiere darte los datos de su vehiculo para poder realizar una solicitud de cotización y sea contactada por un experto, si el usuario dice que si sigue con el proceso de cotización.\n\n\n## **Proceso de cotizacion**\n\n*importante:* todos los datos que obtengas por parte de cliente en sus respuestas year,brand,model,type, typeCristal tienen que estar en tu conocimiento hasta que el proceso termine, tampoco puedes inventarte informacion toda la informacion que des la tienes que consultar siempre con el 'agente_cotizzacion'\n\n*nota:*tambien es importante que el proceso sea secuencial, sigue todos los pasos señalados en este flujo de cotización.\n\n1.- solicita a la herramienta 'agente_cotizzacion' que te de todos los años disponibles en glasbil y presentalos a cliente, no enumerers solo presentalos como una lista con puntos para hacer que el usuario tenga que escribir la respuesta, una vez teniendo la respuesta del año pasaras al siguiente punto\n\n2.- solicita a la herramienta 'agente_cotizzacion' que te de las marcas disponibles de acuerdo al año que el cliente te dio es importante que le mandes esta información al agente por ejemplo:\njson\n{\ntarea:\"soliciuta las marcas disponibles\",\n'year':2025\n}\nuna vezz que te traiga toda la información tambien necesito que lo presentes a cliente como una lista que no este numerada para que el cliente tenga que darte su resopuesta como un texto, en el momento que te de su respuesta pasa al paso 3\n\n3.- solicita a la herramienta 'agente_cotizzacion' que te de los modelos disponibles tomando en cuenta el año y la marca solicitada por el cliente (es importante que estos dos datos se manden para hacer bien la solicitud) ejemplo:\njson\n{\nteare: \"solicita los modelos disponibles\",\nyear:2025,\nbrand:BMW\n}\nuna vez que te retorne informacion presentala como una lista no numerada para que el usuario tenga que escribir el modelo seleccionada, cuando tengas este dato pasamos al paso 4\n\n4.- solicita a la herramienta 'agente_cotizzacion' que te de los tipos de los tipos de carros disponibles usando el año, modelo y marca\nejemplo:\njson\n{\ntarea:\"solicita los tipos de carros disponibles\",\nyear:2025,\nbrand:BMW,\nmodel:4-Series\n}\nuna vez que te retorne informacion presentala como una lista no numerada para que el usuario tenga que escribir el tipo de carro seleccionada, cuando tengas este dato pasamos al paso 5\n\n5.- solicita a la herramienta 'agente_cotizzacion' que te de los tipos de los tipos de cristales disponibles usando el año, marca, modelos y tipo de carros\nejemplo\njson\n{\nteare: \"solicita los tipos de cristal disponibles\",\nyear:\"2025\",\nbrand:\"BMW\",\nmodel:\"4-Series\",\ntype_car:\"2 Door Convertible\"\n}\nuna vez que te retorne informacion presentala como una lista no numerada para que el usuario tenga que escribir el tipo de cristal seleccionada\n\n\nlimitate a usar la informacion que tienes destinada en tu base de conocimiento, entonces por ejemplo si la persona llega preguntando por algo fuera de eso ejemplo, retrovisores, llantas, etc. no des información falsa y mejor da lo que tienes a la mando que es todos los medios de contecto que conoces sobre glasbil como correo de contacto, pagina web y numero de telefono de contacto.\n\nCuida tu ortograía siempre."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        60,
        300
      ],
      "id": "c3132aad-52a4-42b2-a3ce-a72bf44e86fc",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -100,
        560
      ],
      "id": "f271c3b9-05c9-4b9d-a090-d93e7d8d4632",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "zZlJrTGKq8KER7gD",
          "name": "OpenAi account - GLASSY"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1MdybkUkgnwvXUuGsbB2oNIUvkpGcyBw6RBvo199ZqK0",
          "mode": "list",
          "cachedResultName": "codigos postales atencion a clientes",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MdybkUkgnwvXUuGsbB2oNIUvkpGcyBw6RBvo199ZqK0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Hoja 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MdybkUkgnwvXUuGsbB2oNIUvkpGcyBw6RBvo199ZqK0/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.5,
      "position": [
        320,
        440
      ],
      "id": "e7c6c51c-2307-4f06-892e-723e2edc79fc",
      "name": "codigos_postales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "VrznAZQXjQh9WpvY",
          "name": "Google Sheets - Cantera"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -320,
        340
      ],
      "id": "25010742-83ee-405e-b067-fc8d69015662",
      "name": "Telegram Trigger",
      "webhookId": "bf50b0f2-f697-4702-8495-9979a1fb39e2",
      "credentials": {
        "telegramApi": {
          "id": "vcUHDLkV2ZD6YfU8",
          "name": "Telegram account - GLASSY"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        756,
        340
      ],
      "id": "6bd6762b-3062-4722-8eb6-6e005313cd28",
      "name": "Telegram",
      "webhookId": "5949d845-75fd-4068-9ec9-3cf5d007ad55",
      "credentials": {
        "telegramApi": {
          "id": "vcUHDLkV2ZD6YfU8",
          "name": "Telegram account - GLASSY"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        480,
        620
      ],
      "id": "11d9eba2-17bb-41f8-b5aa-e51113fa6364",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "zZlJrTGKq8KER7gD",
          "name": "OpenAi account - GLASSY"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "kb_glasbil",
        "toolDescription": "aqui tienes toda la información de glasbil como:\npolitica de devolucion\ninformacion de aditamentos\npreguntas frecuentes\ndatos de contacto\ndirecciones\nglosario de terminos\nentre mas información disponible",
        "tableName": {
          "__rl": true,
          "value": "documents_glassy",
          "mode": "list",
          "cachedResultName": "documents_glassy"
        },
        "topK": 20,
        "options": {
          "queryName": "match_documents_glassy"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.1,
      "position": [
        440,
        440
      ],
      "id": "bfa9675f-99e8-4e93-b795-c5fdbd45c993",
      "name": "kb_glasbil",
      "credentials": {
        "supabaseApi": {
          "id": "ty0KiXsEYP1uJ8t9",
          "name": "Supabase account - CANTERA"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.message.chat.id }}",
        "tableName": "n8n_chat_histories_glassy_dev",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        20,
        660
      ],
      "id": "c5528067-6c86-492c-91f1-f7656a17fb42",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "CFNWnFQx8hqQIegZ",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        20,
        100
      ],
      "id": "49eb8e8d-91a1-42a4-8075-1c316631c3aa",
      "name": "When clicking ‘Test workflow’"
    },
    {
      "parameters": {
        "operation": "deleteTable",
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "n8n_chat_histories_glassy_dev",
          "mode": "list",
          "cachedResultName": "n8n_chat_histories_glassy_dev"
        },
        "deleteCommand": "drop",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        240,
        100
      ],
      "id": "24bdcbaa-9af0-4b79-b06d-3b6e0ea3d557",
      "name": "Postgres",
      "credentials": {
        "postgres": {
          "id": "CFNWnFQx8hqQIegZ",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "description": "Tienes a la mano un agente que te ayuda a consultar y dar de alta cotizaciones, solo necesitas mandarle la informacion correcta",
        "workflowId": {
          "__rl": true,
          "value": "4QLd4KoP0XGafQmk",
          "mode": "list",
          "cachedResultName": "Agente cotizados glasbil dev"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        260,
        640
      ],
      "id": "95886a4e-f941-4d88-8b12-5bd59b17ea65",
      "name": "agente_cotizzacion"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1,
      "position": [
        140,
        620
      ],
      "id": "7ea39b59-2b7f-4cdf-a48f-b70973ac2b1a",
      "name": "Think"
    },
    {
      "parameters": {
        "method": "POST",
        "url": " https://butik-vidrio.canteradigital.mx/api/productsNotFound/guest",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "brand",
              "value": "="
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        380,
        740
      ],
      "id": "19515bb6-b84a-4b47-b298-444055b4f517",
      "name": "crear cotizacion externa"
    }
  ],
  "connections": {
    "When chat message received": {
      "main": [
        []
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "codigos_postales": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "kb_glasbil",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "kb_glasbil": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Test workflow’": {
      "main": [
        [
          {
            "node": "Postgres",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agente_cotizzacion": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "crear cotizacion externa": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "cb895f94-75d8-48bc-a1c9-d6c2157f55bc",
  "triggerCount": 2,
  "shared": [
    {
      "createdAt": "2025-05-13T18:42:23.050Z",
      "updatedAt": "2025-05-13T18:42:23.050Z",
      "role": "workflow:owner",
      "workflowId": "GJUKvC12lo7L8JjK",
      "projectId": "BZ9Ta5yhe4RhzY78",
      "project": {
        "createdAt": "2025-05-13T15:56:28.209Z",
        "updatedAt": "2025-05-13T16:18:54.372Z",
        "id": "BZ9Ta5yhe4RhzY78",
        "name": "CANTERA ADMIN <canteradigital7@gmail.com>",
        "type": "personal",
        "icon": null,
        "projectRelations": [
          {
            "createdAt": "2025-05-13T15:56:28.209Z",
            "updatedAt": "2025-05-13T15:56:28.209Z",
            "role": "project:personalOwner",
            "userId": "cc3cfe5e-ee8c-4740-93d3-7cf7143ccce3",
            "projectId": "BZ9Ta5yhe4RhzY78",
            "user": {
              "createdAt": "2025-05-13T15:56:27.880Z",
              "updatedAt": "2025-05-27T17:38:25.272Z",
              "id": "cc3cfe5e-ee8c-4740-93d3-7cf7143ccce3",
              "email": "canteradigital7@gmail.com",
              "firstName": "CANTERA",
              "lastName": "ADMIN",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-05-13T16:19:25.161Z",
                "personalization_survey_n8n_version": "1.92.2",
                "companySize": "<20",
                "companyType": "saas",
                "role": "customer-support",
                "reportedSource": "event"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "PTbESRzX3rguwQN8",
                "userActivatedAt": 1747154580970,
                "easyAIWorkflowOnboarded": true,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1748367494893
                }
              },
              "role": "global:owner",
              "disabled": false,
              "mfaEnabled": false,
              "isPending": false,
              "isOwner": true
            }
          }
        ]
      }
    }
  ],
  "tags": [
    {
      "createdAt": "2025-05-13T18:42:21.332Z",
      "updatedAt": "2025-05-13T18:42:21.332Z",
      "id": "XE33dAVH8p6eXZMD",
      "name": "AGENTE GLASSY"
    }
  ]
}